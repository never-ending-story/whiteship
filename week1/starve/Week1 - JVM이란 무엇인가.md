- JVM이란 무엇인가

  * 자바 가상 머신(Java Virtual Machine)을 의미한다. 스택 기반의 가상 머신이며, OS에 구애 받지 않고 자바 프로그램을 실행할 수 있도록 도와준다. 
    자바 코드를 컴파일 할 경우, 컴파일 과정에서 얻은 바이트 코드를 운영체제가 이해할 수 있는 언어로 변환시켜 실행하는 역할을 한다.
  * 자바 개발 도구인 JDK에 포함되어 있기 때문에, JDK를 설치 시 자동으로 Java API(자바 클래스 라이브러리)와 함께 설치 되도록 되어있다.
  * 메모리 관리를 하는 Garvage Collector가 존재하며, 자동으로 메모리 관리를 진행해준다.

  **자바 소스 파일이 JVM 실행되는 과정**

  1. 프로그램 실행 시, JVM이 운영체제로 부터 프로그램이 필요로 하는 메모리를 할당 받음.
     (이 메모리를 용도에 따라 영역을 분리하여 관리한다.)

  2. 자바 컴파일러(javac)가 자바 소스 코드(.java)를 읽어, 자바 바이트 코드(.class)로 변환.

  3. Class Loader를 통해 class파일을 JVM 메모리에 적재

  4. JVM 메모리 영역에 적재된 class 파일을 Execution engine을 통해 해석.

     ![img](https://blog.kakaocdn.net/dn/b8NYFi/btqPFUKvWgm/KIXhDTkcD87GGNiafqnq01/img.jpg)

     

- 컴파일 하는 방법

  * JVM내에서 Java코드를 바로 실행할 수 없기 때문에 컴파일 과정을 거치는데, 이 때 컴파일 된 코드를 Java Bytecode라고 한다.
  * 터미널이나 명령 프롬프트 창에서 `javac [file name].java` 를 입력하여 컴파일을 진행 시킬 수 있다.
    이 때 정상적으로 완료 될 경우, `.java` 파일이 있던 경로에 `[file nam].class` 파일이 생성된다.
    다만 문법적으로 맞지 않을 경우, 에러가 발생하는데 이를 `컴파일 에러` 라고 한다.

- 실행하는 방법

  * 위의 컴파일 과정으로 생성된 `.class` 파일이 있을 경우 실행이 가능하며, 실행하기 위해서는 터미널 내에
    `java [class name]` 을 입력하면 된다. 이 때 class는 사용하지 않아도 된다.
  * 외부 라이브러리 경로를 지정해 줘야 할 경우, `-cp` 옵션을 사용하여  `classpath` 를 지정해 줄 수 있고,
    패키지가 지정 되어있을 경우, `java [package].[class name]` 와 같이 패키지 경로 또한 지정을 해줘야한다.

- 바이트코드란 무엇인가

  * 0과 1로 이루어진 이진 코드이며, 가상 머신이 이해할 수 있는 코드. 사람에게 친숙한 고급 언어로 작성된 코드를 가상 머신이 이해할 수 있도록 컴파일 된 것.

    CPU에게 넘어가기 전, 실시간 번역기 혹은 JIT(just - in - time) 컴파일러에 의해 바이너리 코드로 변환된다.

  * 자바 바이트 코드는, 우리가 작성 한 자바의 코드를 JVM이 해석할 수 있는 언어로 번역한 것을 의미한다.
    

- JIT 컴파일러란 무엇이며 어떻게 동작하는지

  * just - in - time 컴파일러. JVM에서 OS로 넘어 가기 전, 가상머신이 이해할 수 있는 이진 코드인 바이트 코드를 CPU가 이해할 수 있는 이진 코드인 바이너리 코드로 변경 해야하는데, 이 때 사용되는 컴파일러다.

  * 프로그램이 실행 되는 시점에서 컴파일을 시행하며, 캐시를 보관하여 사용하기 때문에, 한 번 컴파일 된 코드는 이전보다 빠르게 수행된다.

  * 바이트 코드를 바이너리 코드로 변환하는 속도가 느린 인터프리터 방식을 보완하기 위해 나왔으며,

    인터프리터 방식으로 기계어 코드를 생성 하다, 적절한 시점에 바이트 코드 전체를 컴파일 하여, 네이티브 코드로 변경하여 이후에는 네이티브 코드로 직접 실행한다.

    기계어 코드로 생성된 코드를 캐싱하여, 같은 함수가 여러번 불릴 때 기계어 코드를 생성하는 것을 방지한다.

  * JVM 내부작동 방식

    1. 자바 컴파일러가 `자바 프로그램 코드 -> 바이트코드` 로 변환
    2. 실제 바이트 코드가 실행하는 시점에 JIT 컴파일러로 기계어 변환

- JVM 구성 요소

  ![img](https://t1.daumcdn.net/cfile/tistory/236D3B4A592574FF07)

  * 클래스 로더(Class Loader)

    * 클래스 파일을 동적으로 OS에서 할당받은 메모리 영역인 Runtime Data Area에 올려 실행하는 역할을 가지고 있다.
    * 메모리에 로딩 되는 과정
      ![img](https://t1.daumcdn.net/cfile/tistory/213EB14A592575000A)
      1. Load : BootStrap, Extension, Application 컴포넌트에 의해 클래스들이 메모리로 로딩
         * 클래스 로더는 계층 구조로 이뤄져 있으며 기본적으로 세가지 클래스 로더가 제공된다.
         * Bootstrap ClassLoader
           - 최상위 우선순위를 가진 클래스 로더
           - jre/lib/rt.jar을 탐색해 기본 java API라이브러리들을 로드한다.
         * Extension ClassLoader
           - jre/lib/ext에 포함된 클래스 파일을 로딩한다. 
           - Bootstrap ClassLoader의 자식이며 jdk 확장 디렉토리에서 로드된다.
         * Application ClassLoader
           - 애플리케이션 클래스패스(애플리케이션 실행할 때 주는 -classpath 옵션 또는 java.class.path 환경 변수의 값에 해당하는 위치)에서 클래스를 읽는다.
           - Extension ClassLoader의 자식이다.
      2. Link
         * Verify : 안전성 검증. 파일들의 보안검사를 실행하여 악성코드를 차단하고, 메모리 연결이 가능한지 검토한다.
           검증 실패 시, 런타임 에러를 볼 수 있다.
         * Prepare : 클래스 변수(static 변수)와 기본 값에 필요한 메모리할당이 진행된다. 초기화가 되는 것 이지만, 코드가 실행되는 것은 아니다.
         * Resolvd : 사용하는 환경에 따라 동작 유무가 정해지며,
           symbolic references 를 direct references로 바꾼다.
           (참조된 클래스 혹은 인터페이스를 로드하고 참조가 올바른지 확인하는 과정을 거친다.)
      3. Initialize : static 변수들이 기본 값으로 초기화 되며, static block이 존재한다면 이 때 실행된다.

  * 런타임 데이터 영역(Runtime Data Area)

    * JVM의 메모리 부분이며, 다섯가지 영역으로 구분할 수 있다.
      1. 메소드 영역 : 클래스 정보를 처음 메모리에 올릴 때,  초기화 되는 대상을 저장하기 위한 메모리 공간.
         모든 Thread가 공유 하는 메모리 영역으로, 클래스, 인터페이스, 메소드, 필드, Static변수 등의 바이트 코드를 보관한다.
      2. 힙 영역 : 객체를 저장하는 가상 메모리 공간. new 연산자로 생성된 객체와 배열을 저장한다.
         GC의 관리 대상에 포함 되며, 런타임 시 동적으로 할당하여 사용한다.
      3. 스택 영역 : 임시로 할당 되었다가 메소드를 빠져나가면 바로 소멸되는 메소드의 매개변수, 지역변수 등 메소드와 같은 특성을 가진 데이터를 저장한다. 
      4. PC Register : Thread 시작 될 때 Thread별로 생성되는 공간으로, 현재 수행 중인 JVM 명령어 주소를 가지게 된다.
      5. Native Method Stack : Java 외의 언어로 작성된 네이티브 코드를 위한 영역이다.
         자바 프로그램이 컴파일 되어 생성되는 바이트 코드가 아닌, 기계어로 작성된 프로그램을 실행시키는 영역.

  * 실행 엔진(Execution Engine)

    * Class Loader를 통해 JVM 내부로 넘어와, 바이트 코드를 기계어로 번역하여 실행한다.
      실행 엔진의 내부적으로 인터프리터, JIT, GC가 존재한다.

      1. 인터프리터 :
         자바 바이트 코드를 명령어 단위로 한 줄씩 읽어서 실행한다.
         기존의 인터프리터의 방식을 그대로 따르기 때문에 느리다는 단점을 가지고 있다.

      2. JIT :
         전체를 컴파일 후, 변경 될 경우 변경된 부분만 컴파일 하기 때문에, 수행 속도가 인터프리터 방식에 비해 빠르다.

      3. GC :

         힙 영역에서 사용하지 않는 객체들을 정리하는 등, 관리해준다.

  * JNI

  * Native Method Library

- JDK와 JRE의 차이

  * JDK :

    Java Development Kit.

    자바 프로그래밍 시, 필요한 컴파일러 등을 포함하고 JRE와 개발에 필요한 도구 (java, javac 등 )들을 포함한다.

  * JRE :
    Java Runtime Enviroment
    컴파일 된 자바 프로그램을 실행시킬 수 있는 자바 환경.
    JVM이 자바 프로그램을 동작시킬 때, 필요한 라이브러리 파일과 기타 파일들을 가지고 있다.

    ![JRE JDK 차이](https://yadon079.github.io/assets/img/study/jdkjre.png)